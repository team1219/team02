<html>
<head>
<!-- META DATA -->
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="description" content="Free Responsive Html5 Templates">
<meta name="author" content="">
<meta name="viewport"
	content="width=device-width,initial-scale=1.0,maximum-scale=1.0, user-scalable=no">

<!--css类引用-->

<link rel="stylesheet" href="js/eleme-ui/index.css" />
<link rel="stylesheet" href="css/ShoppingCart.css" />
<title>购物车</title>

<!-- 引入vue 和 axios -->
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.min.js"></script>
<script
	src="https://cdn.bootcdn.net/ajax/libs/axios/0.19.2/axios.min.js"></script>

<!-- Bootstrap Core CSS -->
<link rel="stylesheet" href="css/bootstrap.min.css" type="text/css">

<!-- Owl Carousel Assets -->
<link href="owl-carousel/owl.carousel.css" rel="stylesheet">
<link href="owl-carousel/owl.theme.css" rel="stylesheet">

<!-- Custom CSS -->
<link rel="stylesheet" href="css/style.css">

<!-- Custom Fonts -->
<link rel="stylesheet"
	href="font-awesome-4.4.0/css/font-awesome.min.css" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Asap:400,700'
	rel='stylesheet' type='text/css'>

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
        <script src="js/html5shiv.js"></script>
        <script src="js/respond.min.js"></script>
    <![endif]-->
<link rel="stylesheet" href="css/shouye.css">

<script src="js/jquery-1.8.3.min.js"></script>
<script src="js/modernizr-custom-v2.7.1.min.js"></script>
<script>
	$(document).ready(function() {
		var $miaobian = $('.Xcontent08>div');
		var $huantu = $('.Xcontent06>img');
		var $miaobian1 = $('.Xcontent26>div');
		$miaobian.mousemove(function() {
			miaobian(this);
		});
		$miaobian1.click(function() {
			miaobian1(this);
		});
		function miaobian(thisMb) {
			for (var i = 0; i < $miaobian.length; i++) {
				$miaobian[i].style.borderColor = '#dedede';
			}
			thisMb.style.borderColor = '#cd2426';

			$huantu[0].src = thisMb.children[0].src;
		}
		function miaobian1(thisMb1) {
			for (var i = 0; i < $miaobian1.length; i++) {
				$miaobian1[i].style.borderColor = '#dedede';
			}
			//thisMb.style.borderColor = '#cd2426';
			$miaobian.css('border-color', '#dedede');
			thisMb1.style.borderColor = '#cd2426';
			$huantu[0].src = thisMb1.children[0].src;
		}
		$(".Xcontent33").click(function() {
			var value = parseInt($('.input').val()) + 1;
			$('.input').val(value);
		})

		$(".Xcontent32").click(function() {
			var num = $(".input").val()
			if (num > 0) {
				$(".input").val(num - 1);
			}

		})

	})
</script>
</head>

<body>


	<!-- /////////////////////////////////////////Navigation -->
	<nav class="navbar navbar-default navbar-fixed-top">
		<div class="container">
			<!-- Brand and toggle get grouped for better mobile display -->
			<div class="navbar-header page-scroll">
				<button type="button" class="navbar-toggle" data-toggle="collapse"
					data-target="#bs-example-navbar-collapse-1">
					<span class="sr-only">Toggle navigation</span> <span
						class="icon-bar"></span> <span class="icon-bar"></span> <span
						class="icon-bar"></span>
				</button>
				<a class="navbar-brand page-scroll" href="#page-top">SweetCake</a>
			</div>

			<!-- Collect the nav links, forms, and other content for toggling -->
			<div class="collapse navbar-collapse"
				id="bs-example-navbar-collapse-1">
				<ul class="nav navbar-nav navbar-right">
					 <li>
                        <a class="page-scroll" href="index.html">主页</a>
                    </li>
                    <li>
                        <a class="page-scroll" href="menu.html">菜单</a>
                    </li>
                    <li>
                        <a class="page-scroll" href="blog.html">博客</a>
                    </li>
                    <li>
                        <a class="page-scroll" href="cart.html">购物车</a>
                    </li>
                     <li>
                        <a class="page-scroll" href="orderDetail.html">我的订单</a>
                    </li>
                     <li>
                        <a class="page-scroll" href="login.html">登录</a>
                    </li>
                    <li>
                        <a class="page-scroll" href="register.html">注册</a>
                    </li>
				</ul>
				
			</div>
			
			<!-- /.navbar-collapse -->
		</div>
		<!-- /.container-fluid -->
	</nav>

	<!-- Navigation -->
	<header class="container">
		<p class="text-center">
			Monday - Friday <strong>11AM to 2PM</strong>, Saturday - Sunday <strong>9Am
				to 2PM</strong>
		</p>
		<!-- CAROUSEL -->
		<div id="carousel-example-generic" class="carousel slide"
			data-ride="carousel" data-interval="4000">
			<!-- Indicators -->
			<ol class="carousel-indicators">
				<li data-target="#carousel-example-generic" data-slide-to="0"
					class="active"></li>
				<li data-target="#carousel-example-generic" data-slide-to="1"></li>
				<li data-target="#carousel-example-generic" data-slide-to="2"></li>
			</ol>

			<!-- Wrapper for slides -->
			<div class="carousel-inner">
				<div class="item active">
					<img src="images/banner1.jpg" alt="...">
					<!-- Static Header -->
					<div class="header-text hidden-xs">
						<h1>
							Great service and <br />atmosphere
						</h1>
						</br>
						<p>
							Start Bootstrap can help you build better websites using the
							Bootstrap CSS framework! <br />Just download your template and
							start going, no strings attached!
						</p>
						</br> <a href="" class="btn btn-primary btn-xl page-scroll">Find
							Out More</a>
					</div>
					<!-- /header-text -->
				</div>
				<div class="item">
					<img src="images/banner2.jpg" alt="...">
					<!-- Static Header -->
					<div class="header-text hidden-xs">
						<h1>
							Great service and <br />atmosphere
						</h1>
						</br>
						<p>
							Start Bootstrap can help you build better websites using the
							Bootstrap CSS framework! <br />Just download your template and
							start going, no strings attached!
						</p>
						</br> <a href="" class="btn btn-primary btn-xl page-scroll">Find
							Out More</a>
					</div>
					<!-- /header-text -->
				</div>
				<div class="item">
					<img src="images/banner3.jpg" alt="...">
					<!-- Static Header -->
					<div class="header-text hidden-xs">
						<h1>
							Great service and <br />atmosphere
						</h1>
						</br>
						<p>
							Start Bootstrap can help you build better websites using the
							Bootstrap CSS framework! <br />Just download your template and
							start going, no strings attached!
						</p>
						</br> <a href="" class="btn btn-primary btn-xl page-scroll">Find
							Out More</a>
					</div>
					<!-- /header-text -->
				</div>
			</div>

			<!-- Controls -->
			<a class="left carousel-control" href="#carousel-example-generic"
				role="button" data-slide="prev"> <span
				class="glyphicon glyphicon-chevron-left"></span>
			</a> <a class="right carousel-control" href="#carousel-example-generic"
				role="button" data-slide="next"> <span
				class="glyphicon glyphicon-chevron-right"></span>
			</a>
		</div>
		<!-- Carousel -->
	</header>


	<!-- /////////////////////////////////////////Content -->
	<div id="page-content" >
		<div id="main-content">
			<div class="container">
				<article>
					<div class="heading">
						<h2>
							<span class="hr"
								style="color: #5D5454; text-transform: uppercase; font-size: 55px;">购物车</span>
						</h2>
					</div>
					<!--主要内容-->
					<form id="myVue" class="row " method="post" action="url">
						<div class="col-lg-10 col-lg-offset-1">
							<div class="layui-form">
								<table class="ShopCartTable layui-table" >
									<thead>
										<tr >
										<th>购物车编号</th>
									    <th class="selectLeft">
								        <input type="checkBox"  @click="checkedAllBtn" v-model="checkedAll" value="on"/>全选
						                </th>
						                <th> <span>商品名称和图片</span></th>
										<th>单价</th>
										<th>数量</th>
										<th>小计</th>
										</tr>
									</thead>
									<tbody>
					<tr v-for="(tabledatas,index) in list" :key="index">
					<td>
					<span>{{tabledatas.oid}}</span>
					</td>
					<td  class="selectLeft">
						<input type="checkbox" style="display: inherit;" @change="checkedRadioBtn(tabledatas,tabledatas.oid)" v-model="tabledatas.checked" :value="tabledatas.oid" />	
					</td>
						<td>
						<span class="goodName">
								<img class="goodImg" :src="tabledatas.cimg" />{{tabledatas.cname}}
							</span>
						</td>
						<td class="danPrice">￥{{tabledatas.price}}</td>
						<td>
						<div class="num">
						<i class="num-jian" @click="goodNum(tabledatas,-1)" class="fa  deleteBtn" aria-hidden="true">-</i>
					    <input  class="num-n" v-model="tabledatas.cnum" type="text" class="form-control numInput" aria-label="...">
						<i class="num-jia" @click="goodNum(tabledatas,1)" aria-hidden="true">+</i>
						</div>	
						</td>
						<td>
							<p class="totalPrice">￥{{tabledatas.price*tabledatas.cnum}}</p>
						</td>
					</tr>
					
				
				</tbody>
				
			</table>
				<div class="row tablefooter">
                <a><span class="deletegoods" @click="deletegoods()">已选商品移出购物车</span></a>
				<span class="servicenum">已选择<span class="goodsNum">{{goodsNum}}</span>件商品</span>
				<span class="totalclassPoin">总价：<span class="totalMoneyClass">￥:{{totalMoney}}</span></span>
				<span @click="saveData" class="SettlementBtn">去结算</span>
			</div>		
							</div>
		
							
						</div>
					</form>
					<script type="text/javascript">
	    var v = new Vue({
	    	el : "#myVue",
	    	data : {
	    		list :[],
	    		name : "",
	    		userBuyData : [],
	    		deleteData : [],
	    		check : 0,
	    		totalPrice : 0,
	    		submit : [],
	    		goodsNum : 0,
	    		totalMoney : 0,
	    		checkedAll : "",
	    		cid : [],
	    		price : [],
                num : [],
	    	},
	    	created(){
	    		this.query();
	    	},
	    	
	    	    		methods: {
	 
	    	    	    	  query(){
	    	    	    	    axios.get("order.s?op=queryOrder",{
	    	    	    	    				params : {
	    	    	    	    					name : this.name,
	    	    	    	    					price : this.list.cprice
	    	    	    	    				}	
	    	    	    	    			}).then(res=>{
	    	    	    	     			   this.list = res.data;
	    	    	    	     			   console.info(this.list);
	    	    	    	     			  if(this.list=="-1"){
	    	    			     				  alert("账号已失效!");
	    	    			     				  location.href="login.html";
	    	    			     			   }
	    	    	    	     		   })
	    	    	    	    		},

	    	    			/*商品数量增加减少函数*/
	    	    			goodNum:function(item,way){
	    	    				if(way == 1){
	    	    					 item.cnum++;
	    	    					
	    	    				}else{
	    	    					if(item.cnum < 1){
	    	    						item.cnum =0;
	    	    					}else{
	    	    						item.cnum--;
	    	    						
	    	    					}
	    	    					
	    	    				}
	    	    				v.countTotalMoney()
	    	    			},
	    	    			/*单选函数*/
	    	    			checkedRadioBtn:function(tabledatas){
	    	    				if(tabledatas.checked == true){
	    	    						this.goodsNum += 1;
	    	    				}else if(tabledatas.checked == false){
	    	    					if(this.goodsNum>0){
	    	    						this.goodsNum -= 1;
	    	    					}else{
	    	    						this.goodsNum=0;
	    	    					}	
	    	    				}else{
	    	    					console.log("未知错误！")
	    	    				}    	    				
	    	    				v.countTotalMoney()
	    	    				
	    	    			},
	    	    			/*全选函数*/
	    	    			checkedAllBtn:function(){
	    	    				console.info("----"+this.checkedAll);
	    	    				console.info(this.checkedAll.constructor);
	    	    				this.checkedAll= this.checkedAll == "on" ? "":"on";
	    	    				console.info("+++"+this.checkedAll);
	    	    				for(y in this.list){
	    	    					if(this.checkedAll=="on"){
    	    						    this.list[y].checked = true;
	    	    					}else{
	    	    						this.list[y].checked = false;
	    	    					}
    	    						if(this.list[y].checked==true){
    	    							this.goodsNum++;
    	    							this.userBuyData =this.list[y].oid; 
    	    						}else{
    	    							this.goodsNum=0;
    	    							this.userBuyData=[];
    	    						}
    	    					}
	    	    				
	    	    				v.countTotalMoney();
	    	    			},
	    	    			
	    	    			/*移出购物车*/
	    	    			deletegoods:function(){
	    	    				var deleteList = [];
	    	    				for(var i=0;i<this.list.length;i++){
    	    						if(this.list[i].checked==true){
    	    							deleteList[i]=this.list[i].oid;
    	    							this.goodsNum--;
    	    					    }		
	    	    				}
	    	    				this.deleteData = deleteList;
	    	    				 axios.get("order.s?op=delete",{
		    		    				params : {
		    		    					deleteData : this.deleteData,
		    		    				}	
		    		    			}).then(res=>{
		    		    				this.submit=res.data;
		    		    				this.query();
		    		    				 if(this.submit=="-1"){
	    			     				   alert("未删除!");
	    			     			   }
		    		     		   })
	    	    				v.countTotalMoney();
	    	    		},
	    	    	      /*计算商品总价函数*/
	    	    			countTotalMoney:function(){
	    	    				var arry = [];
	    	    				for(var i=0;i<this.list.length;i++){
    	    						if(this.list[i].checked==true){
    	    							
    	    					     arry[i]=parseFloat(this.list[i].cnum)*parseFloat(this.list[i].price);	
    	    					    }		
	    	    				}
	    	    				this.totalMoney=arry.reduce((count,v)=>count+v,0);	
	    	    			},
	    	    			/*传递购买数据*/
	    	    			saveData:function(){
	    	    				let id =[]; 
	    	    				let cnum =[]; 
	    	    				let cid = [];
	    	    				let price = [];
	    	    				this.list.forEach(function(item,index){
	    	    					if(item.checked == true){
	    	    						id.push(
	    	    							 item.oid
	    	    						);
	    	    						cid.push(
	    	    								item.cid
	    	    								);
	    	    						cnum.push(
	    	    								item.cnum
	    	    								);
	    	    						price.push(
	    	    								item.price
	    	    								);
	    	    					}
	    	    				})	
	    	    				this.userBuyData=id;
	    	    				this.num = cnum;
	    	    				this.cid = cid;
	    	    				this.price = price
	    	    				axios.get("order.s?op=update",{
	    	    					
	    		    				params : {
	    		    					userBuyData : this.userBuyData,
	    		    					totalMoney : this.totalMoney,
	    		    					cnum :this.num ,
	    		    					cid  : this.cid,
	    		    					price : this.price
	    		    				}	
	    		    			}).then(res=>{
	    		    				setTimeout(function(){
	    		    					window.location.href='order.html#'+0;
	    		    					 }, 2000);
	    		    				
	    		    				console.info(this.userBuyData);
	    		    				console.info( this.totalMoney);
	    		    				console.info(this.num);
	    		     		   })
	    		    		},
	    	    		},
	    		    mounted:function(){
	    		      //为list添加select（是否选中字段，初始值为true）
	    		      var _this=this;
	    		      this.list.map(function(item){    //map:'键值对'
	    		        _this.$set(item,'checked',false)      //往item添加select属性，默认为true
	    		      })
	    		    }
	    	
	    })
	</script>
				</article>
			</div>
		</div>
	</div>

	<!-- FOOTER -->
	<footer>
		<div class="wrap-footer">
			<div class="container">
				<div class="row">
					<div class="col-footer col-md-3">
						<h2 class="footer-title">About Us</h2>
						<div class="textwidget">
							Aenean feugiat in ante et blandit. Vestibulum posuere molestie
							risus, ac interdum magna porta non. Pellentesque rutrum fringilla
							elementum. Curabitur tincidunt porta lorem vitae accumsan. <br>
							<br> Aenean feugiat in ante et blandit. Vestibulum posuere
							molestie risus, ac interdum magna porta non.
						</div>
					</div>
					<div class="col-footer col-md-3 widget_recent_entries">
						<h2 class="footer-title">Recent Posts</h2>
						<ul>
							<li><a href="#">MOST VISITED COUNTRIES</a></li>
							<li><a href="#">5 PLACES THAT MAKE A GREAT HOLIDAY</a></li>
							<li><a href="#">PEBBLE TIME STEEL IS ON TRACK TO SHIP IN
									JULY</a></li>
							<li><a href="#">STARTUP COMPANY&#8217;S CO-FOUNDER TALKS
									ON HIS NEW PRODUCT</a></li>
						</ul>
					</div>
					<div class="col-footer col-md-3">
						<h2 class="footer-title">CONTACT</h2>
						<div class='embed-container maps'>
							<iframe
								src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3164.289259162295!2d-120.7989351!3d37.5246781!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x8091042b3386acd7%3A0x3b4a4cedc60363dd!2sMain+St%2C+Denair%2C+CA+95316%2C+Hoa+K%E1%BB%B3!5e0!3m2!1svi!2s!4v1434016649434"
								width="100%" height="200px" frameborder="0" style="border: 0"></iframe>
						</div>
						<span>JL.Kemacetan timur no.23. block.Q3<br>
							Jakarta-Indonesia
						</span> <span>+6221 888 888 90 <br> +6221 888 88891
						</span> <span>info@yourdomain.com</span>
					</div>
					<div class="col-footer col-md-3">
						<h2 class="footer-title">Tags</h2>
						<div class="footer-tags">
							<a href="#">animals</a> <a href="#">cooking</a> <a href="#">countries</a>
							<a href="#">city</a> <a href="#">children</a> <a href="#">home</a>
							<a href="#">likes</a> <a href="#">photo</a> <a href="#">link</a>
							<a href="#">law</a> <a href="#">shopping</a> <a href="#">skate</a>
							<a href="#">scholl</a> <a href="#">video</a> <a href="#">travel</a>
							<a href="#">images</a> <a href="#">love</a> <a href="#">lists</a>
							<a href="#">makeup</a> <a href="#">media</a> <a href="#">password</a>
							<a href="#">pagination</a> <a href="#">wildlife</a>
						</div>
					</div>
				</div>
			</div>
		</div>
	</footer>

	<!-- jQuery -->
	<script type="text/javascript" src="js/jquery-2.1.1.js"></script>
	<script type="text/javascript" src="js/bootstrap.min.js"></script>

	<!-- Custom Theme JavaScript -->
	<script src="js/agency.js"></script>

	<!-- Plugin JavaScript -->
	<script src="js/jquery.easing.min.js"></script>
	<script src="js/classie.js"></script>
	<script src="js/cbpAnimatedHeader.js"></script>

	<!-- carousel -->
	<script src="owl-carousel/owl.carousel.js"></script>
	<script>
		$(document).ready(function() {
			$("#owl-brand").owlCarousel({
				autoPlay : 3000,
				items : 1,
				itemsDesktop : [ 1199, 1 ],
				itemsDesktopSmall : [ 979, 2 ],
				navigation : false,
			});
		});
	</script>

	<!-- Google Map -->
	<script>
		$('.maps').click(function() {
			$('.maps iframe').css("pointer-events", "auto");
		});

		$(".maps").mouseleave(function() {
			$('.maps iframe').css("pointer-events", "none");
		});
	</script>
	<!--js类引用-->
<script type="text/javascript" src="js/vue/vue.min.js" ></script>
<script type="text/javascript" src="js/eleme-ui/index.js" ></script>
</body>
</html>